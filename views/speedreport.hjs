<!doctype html>

<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=9;IE=8;IE=7;">
    <link rel="stylesheet" href='/stylesheets/black-tie/jquery-ui-1.10.2.custom.min.css' />
    <script src="/javascripts/libs/knockout-2.1.0.js"></script>
    <script src="/javascripts/libs/jquery-1.9.1.js"></script>
    <script src="/javascripts/libs/jquery-ui-1.10.2.custom.min.js"></script>
    <script src="/javascripts/libs/jquery.sparkline.min.js"></script>
    <script src="/javascripts/sparkline_binding.js"></script>
    <script src="/javascripts/polyfills.js"></script>
    <script src="/javascripts/RequestModel.js"></script>
</head>
<body>
<style>
    .asset_graph {
        height: 20px;
        line-height: 20px;
    }

    time.time_long {
        display: inline-block;
        width: 180px;
        text-align: right;
    }

    span.url {
        display: inline-block;
        overflow: hidden;
        white-space: nowrap;
        max-width:80%;
    }

    .bigGraph {
        position: relative;
        width: 100%;
        height: 200px;
        margin: 4px;
    }

    .graphs {
        width: 95%;
        float: left;
    }

    .snapshot {
        width: 30%;
        float: left;
    }
    .ilb{
        display:inline-block;
        float:left;
    }
    #tabs{
        display:none;
    }
    #interstitial{
        display:block;
        position:relative;
        width:100%;
        height:100%;
        font-size:32px;
    }
</style>
<h1>Speed report for <span data-bind="text:url"></span></h1>
<div id="interstitial">
    Analyzing {{url}}...
</div>
<div id="tabs">
    <ul>
        <li><a href="#tabs-1">Stacked</a></li>
        <li><a href="#tabs-2">Blocking</a></li>
        <li><a href="#tabs-3">Latency</a></li>
        <li><a href="#tabs-4">Download Time</a></li>
        <li><a href="#tabs-5">Asset Duration</a></li>
        <li><a href="#tabs-6">Asset Size</a></li>
        <li><a href="#tabs-8">Content Types</a></li>
        <li><a href="#tabs-7">Individual Asset Breakdown</a></li>
    </ul>
    <div class="graphs">
        <div class="bigGraph" id="tabs-1">
            <h2>Stacked</h2>
            <h4>Size, in bytes, of the download</h4>
            <span data-bind="sparkline: stacked, sparklineOptions:{type: 'bar', width:'100%', height: 100, barWidth:'{{barWidth}}',barSpacing:'1px',tooltipFormatter: tooltipFormatterStacked}">Loading...</span>
        </div>
        <div class="bigGraph" id="tabs-2">
            <h2>Blocking</h2>
            <h4>Time spend blocking before the request is made</h4>
            <span data-bind="sparkline: blockings, sparklineOptions:{type: 'bar', barColor:'#3366cc', width:'100%', height: 100, barWidth:'{{barWidth}}',barSpacing:'1px', tooltipFormatter: tooltipFormatter}">Loading...</span>
        </div>
        <div class="bigGraph" id="tabs-3">
            <h2>Latency</h2>
            <h4>Time elapsed from when the request is made until the initial response is received</h4>
            <span data-bind="sparkline: latencies, sparklineOptions:{type: 'bar', barColor:'#dc3912', width:'100%', height: 100, barWidth:'{{barWidth}}',barSpacing:'1px', tooltipFormatter: tooltipFormatter}">Loading...</span>
        </div>
        <div class="bigGraph" id="tabs-4">
            <h2>Download Time</h2>
            <h4>Time elapsed from the first byte received to the last byte received </h4>
            <span data-bind="sparkline: downloadTimes, sparklineOptions:{type: 'bar', barColor:'#ff9900', width:'100%', height: 100, barWidth:'{{barWidth}}',barSpacing:'1px', tooltipFormatter: tooltipFormatter}">Loading...</span>
        </div>
        <div class="bigGraph" id="tabs-5">
            <h2>Asset duration</h2>
            <h4>Total elapsed time from request to completion</h4>
            <span data-bind="sparkline: durations, sparklineOptions:{type: 'bar', barColor:'#109618', width:'100%', height: 100, barWidth:'{{barWidth}}',barSpacing:'1px', tooltipFormatter: tooltipFormatter}">Loading...</span>
        </div>
        <div class="bigGraph"  id="tabs-6">
            <h2>Asset size</h2>
            <h4>Size, in bytes, of the download</h4>
            <span data-bind="sparkline: sizes, sparklineOptions:{type: 'bar', width:'100%', height: 100, barWidth:'{{barWidth}}',barSpacing:'1px', tooltipFormatter: tooltipFormatterBytes}">Loading...</span>
        </div>
        <div class="bigGraph"  id="tabs-8">
            <h2>Content Type</h2>
            <h4>Content Type</h4>
            <span data-bind="sparkline: contentTypes, sparklineOptions:{type: 'bar', width:'100%', height: 100, barWidth:'{{barWidth}}',barSpacing:'1px'}">Loading...</span>
        </div>
        <div  id="tabs-7">
            <h2>Individual Asset breakdown</h2>
            <div data-bind="foreach:assets()">
                <div class="asset_graph">
                    <span class="graph ilb" data-bind="sparkline: [1000, $data.blocking()+$data.duration(),$root.duration(), $data.latency()+$data.duration(), $data.latency()+$data.downloadTime(),$data.latency()], 
                        sparklineOptions:{type: 'bullet', chartRangeMinX:$root.startTime(), chartRangeMaxX:$root.endTime(),  width: '120px', height: '20px', rangeColors:['#ffffff','#dc3912','#ff9900','#109618'],tooltipFormatter:function(el, o, v){return $data.tooltip()+'<br/>'+JSON.stringify(v);}}"></span>
                    <span data-bind="text:id" class=""></span>:&nbsp;
                    <span data-bind="text:url" class="url"></span>
                </div>
            </div>
        </div>
    </div>
</div>
    <div class="" style="float:none;clear:both;">&nbsp;</div>
    <script>
        jQuery(document).ready(function () {
            //window.reportdata={{{reportdata}}};
            jQuery.getJSON('/speedreport/data?url={{url}}',function(reportdata){
                window.model = new PageModel(reportdata);
                $( "#interstitial").hide().next().show();
                ko.applyBindings(window.model);
                //!!!!$.sparkline_display_visible()
                $( "#tabs" ).tabs();
            });
            
        });
    </script>
</body>
</html>
